<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mongodb on 安迪兒隨手貼</title>
    <link>https://bowwow.tips/tags/mongodb/</link>
    <description>Recent content in Mongodb on 安迪兒隨手貼</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Copyright &amp;#169; by 安迪兒</copyright>
    <lastBuildDate>Wed, 01 Jun 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://bowwow.tips/tags/mongodb/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>匯入匯出MongoDB資料成JSON CSV檔案</title>
      <link>https://bowwow.tips/post/20160601/</link>
      <pubDate>Wed, 01 Jun 2016 00:00:00 +0000</pubDate>
      
      <guid>https://bowwow.tips/post/20160601/</guid>
      <description>

&lt;p&gt;前陣子安迪兒剛好碰到要匯出mongodb資料&lt;br /&gt;
需要轉csv給其它人員使用&lt;br /&gt;
查了一下，發現mongodb直接有支援資料匯出成json、csv格式&lt;br /&gt;
(超強XD)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;兩者的區別：&lt;/strong&gt;&lt;br /&gt;
- JSON 是 mongoexport 默認的匯出格式，不需要指定&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CSV 格式需要明確指定欄位屬性名&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一般大多使用json，特殊需求像是需要用到excel之類的文件編輯的，會比較偏向使用csv格式。&lt;br /&gt;
參考以下官方文件&lt;/p&gt;

&lt;p&gt;[mongoexport]&lt;br /&gt;
&lt;a href=&#34;https://docs.mongodb.com/master/reference/program/mongoexport&#34;&gt;https://docs.mongodb.com/master/reference/program/mongoexport&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[mongoimport]&lt;br /&gt;
&lt;a href=&#34;https://docs.mongodb.com/manual/reference/program/mongoimport/#use&#34;&gt;https://docs.mongodb.com/manual/reference/program/mongoimport/#use&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;安迪兒貼一下用的指令&lt;/p&gt;

&lt;h3 id=&#34;匯出:66a2e7b2879656754f6525910eaf4d0e&#34;&gt;匯出:&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;mongodb collection指定欄位匯出資料轉csv&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongoexport --host localhost --db xxdata --collection unknown_data --username xx --password xx --csv --out text.csv --fields _id,lang,pinyin,artists,phonetic,hash_code,created_at,title,vocal_track,filename,hash_method,words
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;mongodb collection資料匯出轉json&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongoexport --host localhost -d xxdata -c unknown_songs -u xxuser -p xxpassword -o output.json

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://goo.gl/FP6y0y&#34; width=&#34;70%&#34;&gt;&lt;/p&gt;

&lt;h3 id=&#34;匯入:66a2e7b2879656754f6525910eaf4d0e&#34;&gt;匯入:&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;測試一下匯入&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongoimport  --host localhost --db xxdata --collection test --username xx --password xx --type csv --headerline --file ./text.csv
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://goo.gl/54DixU&#34; width=&#34;70%&#34;&gt;&lt;/p&gt;

&lt;p&gt;以上~~收工嘍!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>關於MongoDB設定權限</title>
      <link>https://bowwow.tips/post/20160531/</link>
      <pubDate>Tue, 31 May 2016 00:00:00 +0000</pubDate>
      
      <guid>https://bowwow.tips/post/20160531/</guid>
      <description>&lt;p&gt;大家在使用MongoDB，裝完預設其實是沒設定權限的&lt;br /&gt;
因為MongoDB預設你不會對外開放&lt;br /&gt;
一般是會鎖定只給api的機器讀取資料&lt;br /&gt;
但…有資料庫就一定會有權限&lt;br /&gt;
所以遇上要使用帳號密碼登入時要怎辦&lt;br /&gt;
這邊安迪兒記錄一下使用的方式&lt;br /&gt;
大至分為幾個步驟&lt;br /&gt;
1、設定一個管權限的使用者&lt;br /&gt;
2、設定要開放MongoDB的使用者
3、關掉MongoDB，改換用權限啟動的參數，重新啟動MongoDB&lt;/p&gt;

&lt;p&gt;1.首先登入MongoDB&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongo  
use admin ;
db.createUser(
{
user: &amp;quot;xx&amp;quot;,
pwd: &amp;quot;xx&amp;quot;,
roles: [ { role: &amp;quot;userAdminAnyDatabase&amp;quot;, db: &amp;quot;metadata&amp;quot; } ]
}
);
show users;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2.再來設定一下要開放帳號密碼的metadata db&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;use metadata;
{
user: &amp;quot;xx&amp;quot;,
pwd: &amp;quot;xx&amp;quot;,
roles: [ { role: &amp;quot;dbOwner&amp;quot;, db: &amp;quot;metadata&amp;quot; } ]
};
show users;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://goo.gl/H8RmtH&#34; width=&#34;70%&#34;&gt;&lt;/p&gt;

&lt;p&gt;弄完了就下exit離開MongoDB的shell吧&lt;br /&gt;
查一下mongo的process&lt;br /&gt;
然後kill它&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ps aux | grep mongo
sudo kill xxx
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;3.最後重啟一下MongoDB，帶上權限的參數，完成嘍 !&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongod --auth
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;試一下帳號是否可登入&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongo --port 27017 -u &amp;quot;xx&amp;quot; -p &amp;quot;xx&amp;quot; --authenticationDatabase &amp;quot;admin&amp;quot;

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://goo.gl/uPPmL9&#34; width=&#34;70%&#34;&gt;&lt;/p&gt;

&lt;p&gt;另外記錄一下admin資料庫的其它特殊權限&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;readAnyDatabase &amp;gt; 讀取所有資料庫
readWriteAnyDatabase &amp;gt; 讀寫所有資料庫
userAdminAnyDatabase &amp;gt; 管理所有資料庫使用者
dbAdminAnyDatabase &amp;gt; 所有資料庫的管理者
root &amp;gt; 最高權限
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以上~~收工嘍!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>